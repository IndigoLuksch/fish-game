<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish Card Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container lobby-container">
        <h1>üêü Fish Card Game</h1>
        
        <div id="joinSection" class="section">
            <input type="text" id="playerName" placeholder="Your Name" maxlength="20">
            
            <div class="button-group">
                <button id="createBtn" class="btn btn-primary">Create Room</button>
                <div class="divider">or</div>
                <input type="text" id="roomCodeInput" placeholder="Room Code" maxlength="4">
                <button id="joinBtn" class="btn btn-secondary">Join Room</button>
            </div>
        </div>
        
        <div id="lobbySection" class="section hidden">
            <div class="room-code-display">
                Room Code: <span id="roomCode"></span>
            </div>
            
            <div class="players-list">
                <h3>Players</h3>
                <ul id="playersList"></ul>
            </div>
            
            <p class="player-count">Waiting for players... (<span id="playerCount">0</span>/8, need at least 4)</p>
            
            <button id="startBtn" class="btn btn-success" disabled>Start Game</button>
            
            <div class="team-info">
                <p><span class="team-indicator team-1"></span> Team 1 (Players 1, 3, 5, 7)</p>
                <p><span class="team-indicator team-2"></span> Team 2 (Players 2, 4, 6, 8)</p>
            </div>
        </div>
        
        <div id="errorMsg" class="error hidden"></div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoomCode = null;
        
        const playerNameInput = document.getElementById('playerName');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const createBtn = document.getElementById('createBtn');
        const joinBtn = document.getElementById('joinBtn');
        const startBtn = document.getElementById('startBtn');
        const joinSection = document.getElementById('joinSection');
        const lobbySection = document.getElementById('lobbySection');
        const roomCodeDisplay = document.getElementById('roomCode');
        const playersList = document.getElementById('playersList');
        const playerCount = document.getElementById('playerCount');
        const errorMsg = document.getElementById('errorMsg');
        
        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.classList.remove('hidden');
            setTimeout(() => errorMsg.classList.add('hidden'), 3000);
        }
        
        createBtn.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            if (!name) {
                showError('Please enter your name');
                return;
            }
            
            socket.emit('createRoom', name, (response) => {
                if (response.success) {
                    currentRoomCode = response.roomCode;
                    joinSection.classList.add('hidden');
                    lobbySection.classList.remove('hidden');
                    roomCodeDisplay.textContent = response.roomCode;
                } else {
                    showError(response.error);
                }
            });
        });
        
        joinBtn.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            const code = roomCodeInput.value.trim().toUpperCase();
            
            if (!name) {
                showError('Please enter your name');
                return;
            }
            if (!code || code.length !== 4) {
                showError('Please enter a valid 4-character room code');
                return;
            }
            
            socket.emit('joinRoom', { roomCode: code, playerName: name }, (response) => {
                if (response.success) {
                    currentRoomCode = response.roomCode;
                    joinSection.classList.add('hidden');
                    lobbySection.classList.remove('hidden');
                    roomCodeDisplay.textContent = response.roomCode;
                } else {
                    showError(response.error);
                }
            });
        });
        
        startBtn.addEventListener('click', () => {
            socket.emit('startGame', (response) => {
                if (!response.success) {
                    showError(response.error);
                }
            });
        });
        
        socket.on('gameState', (state) => {
            if (state.gameStarted) {
                window.location.href = `/game.html?room=${state.roomCode}`;
                return;
            }

            
            playersList.innerHTML = '';
            state.players.forEach((player, idx) => {
                const li = document.createElement('li');
                li.className = `team-${player.team + 1}`;
                li.textContent = `${idx + 1}. ${player.name}`;
                if (player.id === socket.id) {
                    li.textContent += ' (You)';
                    li.classList.add('you');
                }
                playersList.appendChild(li);
            });
            
            playerCount.textContent = state.players.length;
            startBtn.disabled = state.players.length < 4;
        });
        
        // Handle Enter key
        playerNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (roomCodeInput.value.trim()) {
                    joinBtn.click();
                } else {
                    createBtn.click();
                }
            }
        });
        
        roomCodeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') joinBtn.click();
        });
    </script>
</body>
</html>
